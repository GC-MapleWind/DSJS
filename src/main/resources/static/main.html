<!DOCTYPE html>
<meta charset="utf-8">
<html lang="ko">
<head>
    <title>단생조사</title>
</head>
<body>
<form method="POST" action="/character/uploadAndFetch" enctype="multipart/form-data">
    <input type="file" name="file"/>
    <label>
        <input type="text" name="date" placeholder="날짜입력(YYYY-MM-DD)"/>
    </label>
    <button type="submit">DB에 업로드 후 조회</button>
</form>

<hr>

</body>
    <!-- 버튼 -->
    <button id="exportBtn">엑셀로 추출</button>

    <script>
        // 버튼 클릭 이벤트 리스너
        document.getElementById('exportBtn').addEventListener('click', function() {
            // API 호출
            fetch('/character/export', {
                method: 'GET',
            })
            .then(response => {
                // 응답이 성공적인지 확인
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.blob();  // 응답을 Blob으로 변환 (파일 데이터)
            })
            .then(blob => {
                // Blob 데이터를 URL로 변환
                const url = window.URL.createObjectURL(new Blob([blob]));
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = '단생조사.xlsx';  // 다운로드 파일 이름 설정
                document.body.appendChild(a);
                a.click();  // 파일 다운로드 실행
                window.URL.revokeObjectURL(url);  // 메모리 해제
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
            });
        });
    </script>

<body></body>
</html>
